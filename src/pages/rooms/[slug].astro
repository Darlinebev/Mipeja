---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { hotel } from "../../data/hotel";
import Header from "../../components/Header.astro";

export function getStaticPaths() {
	return hotel.rooms.map((room) => ({
		params: { slug: room.slug },
		props: { room }
	}));
}

const { room } = Astro.props;
const pageTitle = `${room.name} | ${hotel.name}`;
const pageDescription = `${room.name} at ${hotel.name} in ${hotel.location}. Features, rate in ${hotel.currency}, and instant booking.`;
---

<BaseLayout title={pageTitle} description={pageDescription}>
	<div class="min-h-screen bg-beige/30">
		<Header bookingUrl={hotel.bookingUrl} />

		<!-- Subpage Hero -->
		<section class="relative h-[70vh] flex items-center justify-center overflow-hidden">
			<img src={room.image} alt={room.name} class="absolute inset-0 w-full h-full object-cover brightness-50" />
			<div class="relative z-10 text-center space-y-4">
				<p class="text-[10px] uppercase tracking-[0.4em] text-white font-bold">Unrivaled Selection</p>
				<h1 class="text-6xl md:text-8xl font-display text-white italic">{room.name}</h1>
			</div>
		</section>

		<!-- Room Content -->
		<section class="max-w-7xl mx-auto px-6 py-32">
			<div class="grid lg:grid-cols-[1fr_0.4fr] gap-24">
                <div class="space-y-16">
                    <div class="space-y-8">
                        <div class="space-y-4">
                            <p class="text-[10px] uppercase tracking-[0.4em] text-gold font-bold">Pure Relaxation</p>
                            <h2 class="text-5xl font-display text-brown italic">Sophisticated comfort</h2>
                        </div>
                        <p class="text-charcoal/70 leading-relaxed text-lg max-w-2xl">
                            Our {room.name} provides a sanctuary of peace in the heart of the city. Meticulously designed with high-quality materials and thoughtful amenities, it offers the perfect environment for both rest and productivity.
                        </p>
                    </div>

                    <div class="space-y-12">
                         <div class="space-y-4">
                            <p class="text-[10px] uppercase tracking-[0.4em] text-gold font-bold">In-room amenities</p>
                            <h3 class="text-3xl font-display text-brown italic">Thoughtful details</h3>
                        </div>
                        <div class="grid sm:grid-cols-2 gap-x-12 gap-y-6">
                            {room.features.map(feature => (
                                <div class="flex items-center gap-4 text-xs font-bold uppercase tracking-[0.2em] text-charcoal/70 border-b border-beige pb-4">
                                    <span class="text-gold">✦</span> {feature}
                                </div>
                            ))}
                            {hotel.amenities.slice(0, 4).map(item => (
                                <div class="flex items-center gap-4 text-xs font-bold uppercase tracking-[0.2em] text-charcoal/70 border-b border-beige pb-4">
                                    <span class="text-gold">✦</span> {item}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>

                <div class="space-y-12">
                    <div class="bg-white p-12 shadow-2xl border border-beige space-y-8">
                        <div class="space-y-2">
                             <span class="text-[10px] uppercase tracking-widest block opacity-50 font-bold">Price per night</span>
                             <p class="text-5xl font-display italic text-brown">{room.price}</p>
                        </div>
                        <div class="space-y-4 pt-4 border-t border-beige">
                             <a href={hotel.bookingUrl} class="block w-full bg-brown text-white py-6 text-center text-[10px] uppercase tracking-[0.4em] font-bold hover:bg-gold transition-all">Book This Room</a>
                             <p class="text-center text-[8px] uppercase tracking-widest text-charcoal/40">Free cancellation available</p>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <p class="text-[10px] uppercase tracking-[0.4em] text-gold font-bold">Assistance</p>
                        <p class="text-xs font-bold text-brown uppercase tracking-widest">Need help with your booking?</p>
                        <div class="space-y-2 text-xs uppercase tracking-widest text-charcoal/60">
                             <p>{hotel.phone}</p>
                             <p>{hotel.email}</p>
                        </div>
                    </div>
                </div>
            </div>
		</section>

        <!-- Other Rooms (Slider) -->
        <section class="bg-white py-32 border-t border-beige">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex flex-col md:flex-row justify-between items-end gap-8 mb-12">
                    <div class="space-y-4">
                        <p class="text-[10px] uppercase tracking-[0.4em] text-gold font-bold">Exquisite Selection</p>
                        <h2 class="text-5xl font-display text-brown">Discover more rooms</h2>
                    </div>
                    <a href="/rooms" class="text-[10px] uppercase tracking-[0.3em] font-bold text-charcoal/60 border-b border-gold-dark/30 hover:border-gold pb-1 transition-all">View all rooms →</a>
                </div>

                <div class="relative">
                    <button id="prevBtn" class="absolute left-0 top-1/2 -translate-y-1/2 z-20 bg-white/10 text-white w-12 h-12 flex items-center justify-center rounded-none hover:bg-white/20">◀</button>
                    <button id="nextBtn" class="absolute right-0 top-1/2 -translate-y-1/2 z-20 bg-white/10 text-white w-12 h-12 flex items-center justify-center rounded-none hover:bg-white/20">▶</button>

                    <div id="other-rooms-container" class="overflow-hidden">
                        <div id="other-rooms-track" class="flex gap-8 transition-transform duration-500 will-change-transform">
                            {hotel.rooms.filter((item) => item.slug !== room.slug).map((item) => (
                                <a href={`/rooms/${item.slug}`} class="min-w-full md:min-w-1/2 lg:min-w-1/3 group space-y-6 block">
                                    <div class="aspect-video overflow-hidden rounded-lg">
                                        <img src={item.image} alt={item.name} class="w-full h-full object-cover grayscale opacity-80 group-hover:grayscale-0 group-hover:opacity-100 group-hover:scale-105 transition-all duration-700" loading="lazy" />
                                    </div>
                                    <div class="space-y-2">
                                        <h3 class="font-display text-2xl text-brown">{item.name}</h3>
                                        <p class="text-[10px] uppercase tracking-widest text-charcoal/50 font-bold font-body">From {item.price}</p>
                                    </div>
                                </a>
                            ))}
                        </div>
                    </div>
                    <div id="other-rooms-dots" class="flex items-center justify-center gap-3 mt-8"></div>
                </div>
            </div>
        </section>

        <footer class="bg-charcoal text-white py-24 border-t border-white/5 font-body">
            <div class="max-w-7xl mx-auto px-6">
                <div class="grid lg:grid-cols-4 gap-16">
                    <div class="col-span-2 space-y-8">
                        <div>
                            <p class="font-display text-3xl font-bold tracking-widest uppercase mb-4">{hotel.name}</p>
                            <p class="text-xs opacity-60 uppercase tracking-[0.2em] max-w-sm leading-relaxed">{hotel.tagline}</p>
                        </div>
                        <div class="flex gap-6">
                            {hotel.socials?.map((social) => (
                                <a href={social.url} target="_blank" rel="noreferrer" class="text-white hover:text-gold transition-colors text-xs uppercase tracking-widest">
                                    {social.label}
                                </a>
                            ))}
                        </div>
                    </div>
                    <div class="space-y-6">
                        <p class="text-[10px] uppercase tracking-[0.3em] font-bold text-gold">Contact Us</p>
                        <div class="space-y-4 text-xs uppercase tracking-widest opacity-70">
                            <p>{hotel.location}</p>
                            <p>{hotel.phone}</p>
                            <p>{hotel.email}</p>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <p class="text-[10px] uppercase tracking-[0.3em] font-bold text-gold">Quick Links</p>
                        <nav class="flex flex-col gap-4 text-xs uppercase tracking-widest opacity-70">
                            <a href="/rooms" class="hover:text-gold transition-colors">Rooms & Suites</a>
                            <a href="/amenities" class="hover:text-gold transition-colors">Experience</a>
                            <a href="/about" class="hover:text-gold transition-colors">Our Story</a>
                            <a href="/contact" class="hover:text-gold transition-colors">Get in touch</a>
                        </nav>
                    </div>
                </div>
                <div class="mt-20 pt-12 border-t border-white/5 flex flex-col md:flex-row justify-between items-center gap-6 text-[10px] uppercase tracking-[0.3em] opacity-40">
                    <p>© {new Date().getFullYear()} {hotel.name}. All rights reserved.</p>
                    <div class="flex gap-8">
                        <span>Terms & Conditions</span>
                        <span>Privacy Policy</span>
                    </div>
                </div>
            </div>
        </footer>

        <script>
            (() => {
                const container = document.getElementById('other-rooms-container');
                const track = document.getElementById('other-rooms-track');
                const prev = document.getElementById('prevBtn');
                const next = document.getElementById('nextBtn');
                const dotsWrap = document.getElementById('other-rooms-dots');
                let slides = Array.from(track.children);
                let current = 0;
                let slidesPerView = 1;
                let autoplayInterval = null;

                function updateSlidesPerView() {
                    const w = window.innerWidth;
                    if (w >= 1024) slidesPerView = 3;
                    else if (w >= 768) slidesPerView = 2;
                    else slidesPerView = 1;
                }

                function updateSizes() {
                    updateSlidesPerView();
                    slides = Array.from(track.children);
                    slides.forEach(s => s.style.minWidth = (container.clientWidth / slidesPerView) + 'px');
                    moveTo(current);
                    renderDots();
                }

                function moveTo(index) {
                    const maxIndex = Math.max(0, slides.length - slidesPerView);
                    current = Math.min(Math.max(0, index), maxIndex);
                    const offset = current * (container.clientWidth / slidesPerView);
                    track.style.transform = `translateX(-${offset}px)`;
                    updateActiveDot();
                }

                function prevSlide() { moveTo(current - 1); }
                function nextSlide() { moveTo(current + 1); }

                function renderDots() {
                    dotsWrap.innerHTML = '';
                    const count = Math.max(1, slides.length - slidesPerView + 1);
                    for (let i = 0; i < count; i++) {
                        const d = document.createElement('button');
                        d.className = 'w-3 h-3 rounded-full bg-white/30';
                        d.addEventListener('click', () => moveTo(i));
                        dotsWrap.appendChild(d);
                    }
                    updateActiveDot();
                }

                function updateActiveDot() {
                    Array.from(dotsWrap.children).forEach((d, i) => {
                        d.classList.toggle('bg-gold', i === current);
                        d.classList.toggle('bg-white/30', i !== current);
                    });
                }

                prev.addEventListener('click', () => { prevSlide(); resetAutoplay(); });
                next.addEventListener('click', () => { nextSlide(); resetAutoplay(); });

                window.addEventListener('resize', updateSizes);

                function startAutoplay() {
                    autoplayInterval = setInterval(() => {
                        const maxIndex = Math.max(0, slides.length - slidesPerView);
                        if (current >= maxIndex) moveTo(0);
                        else moveTo(current + 1);
                    }, 4000);
                }

                function resetAutoplay() {
                    clearInterval(autoplayInterval);
                    startAutoplay();
                }

                updateSizes();
                startAutoplay();
            })();
        </script>
	</div>
</BaseLayout>

