---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { hotel } from "../../data/hotel";
import Header from "../../components/Header.astro";

export function getStaticPaths() {
	return hotel.rooms.map((room) => ({
		params: { slug: room.slug },
		props: { room }
	}));
}

const { room } = Astro.props;
const pageTitle = `${room.name} | ${hotel.name}`;
const pageDescription = `${room.name} at ${hotel.name} in ${hotel.location}. Features, rate in ${hotel.currency}, and instant booking.`;
---

<BaseLayout title={pageTitle} description={pageDescription}>
	<div class="min-h-screen bg-theme-off-white">
		<Header bookingUrl={hotel.bookingUrl} />

        <!-- Subpage Hero -->
        <section class="relative h-[55vh] sm:h-[60vh] md:h-[70vh] flex items-center justify-center overflow-hidden">
            <img src={room.image} alt={room.name} class="absolute inset-0 w-full h-full object-cover brightness-50" />
            <div class="relative z-10 text-center space-y-3 sm:space-y-4 px-4">
                <p class="text-[10px] uppercase tracking-[0.3em] sm:tracking-[0.4em] text-white font-bold">Unrivaled Selection</p>
                <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-8xl font-display text-white italic">{room.name}</h1>
            </div>
        </section>

		<!-- Room Content -->
		<section class="max-w-7xl mx-auto px-4 sm:px-6 py-16 sm:py-24 md:py-32">
			<div class="grid lg:grid-cols-[1fr_0.4fr] gap-12 sm:gap-16 md:gap-24">
                <div class="space-y-16">
                    <div class="space-y-8">
                        <div class="space-y-4">
                            <p class="text-[10px] uppercase tracking-[0.3em] sm:tracking-[0.4em] text-theme-gold font-bold">Pure Relaxation</p>
                            <h2 class="text-3xl sm:text-4xl md:text-5xl font-display text-theme-black italic">Sophisticated comfort</h2>
                        </div>
                        <p class="text-charcoal/70 leading-relaxed text-sm sm:text-base md:text-lg max-w-2xl">
                            Our {room.name} provides a sanctuary of peace in the heart of the city. Meticulously designed with high-quality materials and thoughtful amenities, it offers the perfect environment for both rest and productivity.
                        </p>
                    </div>

                    <div class="space-y-12">
                         <div class="space-y-4">
                            <p class="text-[10px] uppercase tracking-[0.3em] sm:tracking-[0.4em] text-theme-gold font-bold">In-room amenities</p>
                            <h3 class="text-2xl sm:text-3xl font-display text-theme-black italic">Thoughtful details</h3>
                        </div>
                        <div class="grid sm:grid-cols-2 gap-x-6 sm:gap-x-12 gap-y-4 sm:gap-y-6">
                            {room.features.map(feature => (
                                <div class="flex items-center gap-3 sm:gap-4 text-[10px] sm:text-xs font-bold uppercase tracking-[0.2em] text-charcoal/70 border-b border-gray-200 pb-3 sm:pb-4">
                                    <span class="text-theme-gold">✦</span> {feature}
                                </div>
                            ))}
                            {hotel.amenities.slice(0, 4).map(item => (
                                <div class="flex items-center gap-3 sm:gap-4 text-[10px] sm:text-xs font-bold uppercase tracking-[0.2em] text-charcoal/70 border-b border-gray-200 pb-3 sm:pb-4">
                                    <span class="text-theme-gold">✦</span> {item}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>

                <div class="space-y-8 sm:space-y-12">
                    <div class="bg-white p-6 sm:p-8 md:p-12 shadow-2xl border border-gray-100 space-y-6 sm:space-y-8">
                        <div class="space-y-2">
                             <span class="text-[10px] uppercase tracking-widest block opacity-50 font-bold">Price per night</span>
                             <p class="text-3xl sm:text-4xl md:text-5xl font-display italic text-theme-black">{room.price}</p>
                        </div>
                        <div class="space-y-4 pt-4 border-t border-gray-100">
                             <a href={hotel.bookingUrl} class="block w-full bg-theme-black text-white py-4 sm:py-6 text-center text-[10px] uppercase tracking-[0.4em] font-bold hover:bg-theme-gold transition-all">Book This Room</a>
                             <p class="text-center text-[8px] uppercase tracking-widest text-charcoal/40">Free cancellation available</p>
                        </div>
                    </div>

                    <div class="space-y-4 sm:space-y-6">
                        <p class="text-[10px] uppercase tracking-[0.3em] sm:tracking-[0.4em] text-theme-gold font-bold">Assistance</p>
                        <p class="text-xs font-bold text-theme-black uppercase tracking-widest">Need help with your booking?</p>
                        <div class="space-y-2 text-xs uppercase tracking-widest text-charcoal/60">
                             <p class="break-all">{hotel.phone}</p>
                             <p class="break-all">{hotel.email}</p>
                        </div>
                    </div>
                </div>
            </div>
		</section>

        <!-- Other Rooms (Slider) -->
        <section class="bg-white py-16 sm:py-24 md:py-32 border-t border-gray-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 sm:gap-8 mb-8 sm:mb-12">
                    <div class="space-y-3 sm:space-y-4">
                        <p class="text-[10px] uppercase tracking-[0.3em] sm:tracking-[0.4em] text-theme-gold font-bold">Exquisite Selection</p>
                        <h2 class="text-3xl sm:text-4xl md:text-5xl font-display text-theme-black">Discover more rooms</h2>
                    </div>
                    <a href="/rooms" class="text-[10px] uppercase tracking-[0.3em] font-bold text-charcoal/60 border-b border-theme-black/30 hover:border-theme-gold pb-1 transition-all">View all rooms →</a>
                </div>

                <div class="relative">
                    <button id="prevBtn" class="absolute left-0 top-1/2 -translate-y-1/2 z-20 bg-white/10 text-white w-10 h-10 sm:w-12 sm:h-12 items-center justify-center rounded-none hover:bg-white/20 hidden sm:flex">◀</button>
                    <button id="nextBtn" class="absolute right-0 top-1/2 -translate-y-1/2 z-20 bg-white/10 text-white w-10 h-10 sm:w-12 sm:h-12 items-center justify-center rounded-none hover:bg-white/20 hidden sm:flex">▶</button>

                    <div id="other-rooms-container" class="overflow-hidden">
                        <div id="other-rooms-track" class="flex gap-4 sm:gap-6 md:gap-8 transition-transform duration-500 will-change-transform">
                            {hotel.rooms.filter((item) => item.slug !== room.slug).map((item) => (
                                <a href={`/rooms/${item.slug}`} class="flex-shrink-0 w-full group space-y-4 sm:space-y-6 block">
                                    <div class="aspect-video overflow-hidden rounded-lg">
                                        <img src={item.image} alt={item.name} class="w-full h-full object-cover grayscale opacity-80 group-hover:grayscale-0 group-hover:opacity-100 group-hover:scale-105 transition-all duration-700" loading="lazy" />
                                    </div>
                                    <div class="space-y-2">
                                        <h3 class="font-display text-xl sm:text-2xl text-theme-black">{item.name}</h3>
                                        <p class="text-[10px] uppercase tracking-widest text-charcoal/50 font-bold font-body">From {item.price}</p>
                                    </div>
                                </a>
                            ))}
                        </div>
                    </div>
                    <div id="other-rooms-dots" class="flex items-center justify-center gap-3 mt-8"></div>
                </div>
            </div>
        </section>

        
        <script>
            (() => {
                const container = document.getElementById('other-rooms-container');
                const track = document.getElementById('other-rooms-track');
                const prev = document.getElementById('prevBtn');
                const next = document.getElementById('nextBtn');
                const dotsWrap = document.getElementById('other-rooms-dots');
                let slidesPerView = 1;
                let autoplayInterval = null;
                let transitionDuration = 500; // ms

                function updateSlidesPerView() {
                    const w = window.innerWidth;
                    if (w >= 1024) slidesPerView = 3;
                    else if (w >= 768) slidesPerView = 2;
                    else slidesPerView = 1;
                }

                function setupCarousel() {
                    updateSlidesPerView();
                    // clean any existing clones
                    Array.from(track.querySelectorAll('.__clone')).forEach(n => n.remove());

                    const original = Array.from(track.children);
                    const originalCount = original.length;
                    if (!originalCount) return;

                    // create clones
                    const clonesBefore = [];
                    const clonesAfter = [];
                    for (let i = 0; i < slidesPerView; i++) {
                        const before = original[originalCount - 1 - i].cloneNode(true);
                        before.classList.add('__clone');
                        clonesBefore.unshift(before);
                        const after = original[i].cloneNode(true);
                        after.classList.add('__clone');
                        clonesAfter.push(after);
                    }

                    clonesBefore.forEach(n => track.insertBefore(n, track.firstChild));
                    clonesAfter.forEach(n => track.appendChild(n));

                    // recompute slides
                    const slides = Array.from(track.children);

                    // sizing
                    const slideWidth = container.clientWidth / slidesPerView;
                    slides.forEach(s => s.style.minWidth = slideWidth + 'px');

                    // start index (after clonesBefore)
                    let index = slidesPerView;
                    track.style.transition = `transform ${transitionDuration}ms ease`;
                    track.style.transform = `translateX(-${index * slideWidth}px)`;

                    // dots
                    renderDots(originalCount);

                    // events
                    track.addEventListener('transitionend', () => {
                        const slidesNow = Array.from(track.children);
                        const total = slidesNow.length;
                        const maxIndex = total - slidesPerView;
                        if (index <= slidesPerView - 1) {
                            // jumped to clones at start -> jump to real ones
                            index = index + originalCount;
                            track.style.transition = 'none';
                            track.style.transform = `translateX(-${index * slideWidth}px)`;
                            // force repaint
                            void track.offsetWidth;
                            track.style.transition = `transform ${transitionDuration}ms ease`;
                        } else if (index >= originalCount + slidesPerView) {
                            index = index - originalCount;
                            track.style.transition = 'none';
                            track.style.transform = `translateX(-${index * slideWidth}px)`;
                            void track.offsetWidth;
                            track.style.transition = `transform ${transitionDuration}ms ease`;
                        }
                        updateActiveDot(index - slidesPerView, originalCount);
                    });

                    // control handlers
                    prev.onclick = () => { moveBy(-1); resetAutoplay(); };
                    next.onclick = () => { moveBy(1); resetAutoplay(); };

                    function moveBy(delta) {
                        index += delta;
                        track.style.transform = `translateX(-${index * slideWidth}px)`;
                    }

                    function renderDots(count) {
                        dotsWrap.innerHTML = '';
                        for (let i = 0; i < count; i++) {
                            const btn = document.createElement('button');
                            btn.className = 'w-3 h-3 rounded-full bg-white/30';
                            btn.addEventListener('click', () => {
                                index = i + slidesPerView;
                                track.style.transform = `translateX(-${index * slideWidth}px)`;
                                resetAutoplay();
                            });
                            dotsWrap.appendChild(btn);
                        }
                        updateActiveDot(0, count);
                    }

                    function updateActiveDot(logicalIndex, count) {
                        const active = ((index - slidesPerView) % count + count) % count;
                        Array.from(dotsWrap.children).forEach((d, i) => {
                            d.classList.toggle('bg-theme-gold', i === active);
                            d.classList.toggle('bg-gray-300', i !== active);
                        });
                    }

                    function startAutoplay() {
                        autoplayInterval = setInterval(() => { moveBy(1); }, 4000);
                    }

                    function resetAutoplay() { clearInterval(autoplayInterval); startAutoplay(); }

                    startAutoplay();
                }

                window.addEventListener('resize', () => {
                    // debounce simple
                    clearTimeout(window.__rooms_resize_timeout);
                    window.__rooms_resize_timeout = setTimeout(() => setupCarousel(), 150);
                });

                // initial setup
                setupCarousel();
            })();
        </script>
	</div>
</BaseLayout>

